---
title: ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ê³„
tags:
  - í”„ë¡œì íŠ¸
created: 2025-06-13 01:36:28
related_project:
  - "[[ê°ì •ì¸ì‹ ë¶„ë¥˜ëª¨ë¸]]"
category: sub-project
link:
---
# ğŸ¬ ê¸´ ì˜ìƒ ì¬ë¯¸ í´ë¦½ ì¶”ì¶œ ì‹œìŠ¤í…œ - ìµœì¢… ì„¤ê³„ ë¬¸ì„œ

## ğŸ“‹ **í”„ë¡œì íŠ¸ ê°œìš”**

### **ğŸ¯ ëª©ì **

20ë¶„~ëª‡ ì‹œê°„ì§œë¦¬ ê¸´ ì˜ìƒì—ì„œ ì¬ë°ŒëŠ” 15~40ì´ˆ í´ë¦½ë“¤ì„ ìë™ìœ¼ë¡œ ì°¾ì•„ì„œ ì¶”ì¶œí•˜ëŠ” AI ì‹œìŠ¤í…œ

### **ğŸ”„ ì „ì²´ í”Œë¡œìš°**

```
ê¸´ ì˜ìƒ (1~3ì‹œê°„)
    â†“ ê¸°ì¡´ integrated_pipeline.py (ì „ì²˜ë¦¬)
HDF5 + JSON ë°ì´í„°
    â†“ í•˜ì´ë¼ì´íŠ¸ í´ëŸ¬ìŠ¤í„°ë§ (DBSCAN)
í´ëŸ¬ìŠ¤í„° ê¸°ë°˜ ìœˆë„ìš° ìƒì„±
    â†“ XGBoost ì¬ë¯¸ë„ í‰ê°€
scored_windows.json ì €ì¥ (í•µì‹¬!)
    â†“ Config ê¸°ë°˜ í´ë¦½ ì„ ë³„ (ë¬´í•œ ì‹¤í—˜)
ìµœì¢… ì¬ë°ŒëŠ” í´ë¦½ë“¤
```

---

## ğŸª **í•µì‹¬ ì•Œê³ ë¦¬ì¦˜**

### **1. DBSCAN í•˜ì´ë¼ì´íŠ¸ í´ëŸ¬ìŠ¤í„°ë§**

- **ì…ë ¥**: í…ì…˜ JSONì˜ í•˜ì´ë¼ì´íŠ¸ë“¤ (ì˜ˆ: 277ê°œ)
- **ì „ì²˜ë¦¬**: ë‹¨ì¼ í•˜ì´ë¼ì´íŠ¸ì— ì•ë’¤ 3ì´ˆ ê°€ìƒ í¬ì¸íŠ¸ ì¶”ê°€
- **í´ëŸ¬ìŠ¤í„°ë§**: Îµ=9ì´ˆ, min_samples=1
- **ì¶œë ¥**: ë°€ì§‘ êµ¬ê°„ë³„ í´ëŸ¬ìŠ¤í„°ë“¤ (ì˜ˆ: 39ê°œ)

### **2. 3/4 ì§€ì  ìœˆë„ìš° ë°°ì¹˜**

- **ì „ëµ**: í•˜ì´ë¼ì´íŠ¸ë¥¼ ìœˆë„ìš°ì˜ ë’¤ìª½(3/4 ì§€ì )ì— ë°°ì¹˜
- **ê·¼ê±°**: XGB í•™ìŠµ ê²°ê³¼ì—ì„œ "segment4(ë§ˆì§€ë§‰ êµ¬ê°„)ê°€ ê°€ì¥ ì¤‘ìš”"
- **ê³µì‹**: `start_time = highlight_time - 0.75 * window_length`

### **3. ê·¸ë¦¬ë“œ ì„œì¹˜ ìœˆë„ìš° ìƒì„±**

- **ê¸¸ì´**: 18~40ì´ˆ (23ê°€ì§€)
- **ìŠ¬ë¼ì´ë”©**: 1ì´ˆ ê°„ê²©
- **ê²°ê³¼**: ì•½ 5,665ê°œ ìœˆë„ìš° (vs ì „ì²´ ê·¸ë¦¬ë“œ 21,896ê°œ)

### **4. XGBoost ì¬ë¯¸ë„ í‰ê°€**

- **íŠ¹ì§• ì¶”ì¶œ**: ê¸°ì¡´ dataset_generator ì¬í™œìš© (112ì°¨ì›)
- **ëª¨ë¸**: í•™ìŠµëœ XGB ë¶„ë¥˜ê¸°
- **ì¶œë ¥**: ê° ìœˆë„ìš°ë³„ ì¬ë¯¸ë„ ì ìˆ˜ (0~1)

### **5. Config ê¸°ë°˜ NMS ì„ ë³„**

- **IoU ê³„ì‚°**: ì‹œê°„ ê¸°ë°˜ ê²¹ì¹¨ ë¹„ìœ¨
- **ì„¤ì • ë³€ê²½**: config íŒŒì¼ ìˆ˜ì •ë§Œìœ¼ë¡œ ì¦‰ì‹œ ì‹¤í—˜
- **ê²°ê³¼**: ê²¹ì¹˜ì§€ ì•ŠëŠ” ìƒìœ„ Nê°œ í´ë¦½

---

## ğŸ“ **ë””ë ‰í† ë¦¬ êµ¬ì¡°**

```
pipeline/
â”œâ”€â”€ configs/
â”‚   â”œâ”€â”€ integrated_config.yaml          # ê¸°ì¡´
â”‚   â””â”€â”€ clip_selection_config.yaml      # ğŸ†• í´ë¦½ ì„ ë³„ ì„¤ì •
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ emotion_highlighter.py          # ê¸°ì¡´
â”‚   â”œâ”€â”€ angry_classifier.py             # ê¸°ì¡´
â”‚   â”œâ”€â”€ highlight_clusterer.py          # ğŸ†• DBSCAN í´ëŸ¬ìŠ¤í„°ë§
â”‚   â”œâ”€â”€ window_generator.py             # ğŸ†• ìœˆë„ìš° ìƒì„± + XGB í‰ê°€
â”‚   â””â”€â”€ clip_selector.py               # ğŸ†• ì ìˆ˜ ê¸°ë°˜ í´ë¦½ ì„ ë³„
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ pipeline_utils.py               # ê¸°ì¡´ (ì¬í™œìš©)
â”‚   â””â”€â”€ result_saver.py                 # ğŸ†• ê²°ê³¼ ì €ì¥ ê´€ë¦¬
â”œâ”€â”€ integrated_pipeline.py              # ê¸°ì¡´ ì „ì²˜ë¦¬
â”œâ”€â”€ generate_scored_windows.py          # ğŸ†• 1ë‹¨ê³„: ì ìˆ˜ ê³„ì‚°
â””â”€â”€ select_clips.py                     # ğŸ†• 2ë‹¨ê³„: Config ê¸°ë°˜ ì„ ë³„
```

---

## ğŸ”§ **í•µì‹¬ ëª¨ë“ˆ ì„¤ê³„**

### **ğŸª 1. `highlight_clusterer.py`**

```python
class HighlightClusterer:
    def load_tension_highlights(tension_json_path) -> List[Dict]
    def augment_single_highlights(highlights, buffer=3) -> List[Dict]
    def cluster_with_dbscan(highlights, eps=9) -> List[Dict]
    def get_cluster_spans(clusters) -> List[Dict]
```

### **ğŸ” 2. `window_generator.py`**

```python
class WindowGenerator:
    def generate_cluster_windows(clusters, video_duration) -> List[Dict]
    def extract_features_for_windows(windows, files) -> np.ndarray
    def evaluate_with_xgb(features) -> List[float]
    def generate_and_score_windows(clusters, files) -> List[Dict]
```

### **ğŸ¯ 3. `clip_selector.py`**

```python
class ClipSelector:
    def load_scored_windows(video_path) -> List[Dict]
    def calculate_iou(window1, window2) -> float
    def non_max_suppression(windows, iou_threshold) -> List[Dict]
    def select_clips_with_config(video_path, config) -> List[Dict]
```

### **ğŸ’¾ 4. `result_saver.py`**

```python
class ClipAnalysisResultSaver:
    def create_video_output_dir(video_path) -> str
    def save_clusters(output_dir, clusters, config) -> None
    def save_scored_windows(output_dir, scored_windows, config) -> None
    def save_final_clips(output_dir, clips, config) -> None
```

---

## âš™ï¸ **Config íŒŒì¼ êµ¬ì¡°**

### **ğŸ“„ `clip_selection_config.yaml`**

```yaml
# NMS ì„¤ì • (ì£¼ìš” ì‹¤í—˜ ëŒ€ìƒ)
nms:
  iou_threshold: 0.5      # ê²¹ì¹¨ í—ˆìš©ë„ (0.3=ê´€ëŒ€, 0.7=ì—„ê²©)
  target_clips: 5         # ì¶”ì¶œí•  í´ë¦½ ê°œìˆ˜
  min_score: 0.0         # ìµœì†Œ ì¬ë¯¸ë„ ì ìˆ˜

# ê¸¸ì´ í•„í„° (ì„ íƒì‚¬í•­)  
filtering:
  min_duration: 15       # ìµœì†Œ í´ë¦½ ê¸¸ì´ (ì´ˆ)
  max_duration: 40       # ìµœëŒ€ í´ë¦½ ê¸¸ì´ (ì´ˆ)

# ì¶œë ¥ ì„¤ì •
output:
  save_details: true     # ìƒì„¸ ì •ë³´ ì €ì¥ ì—¬ë¶€
```

---

## ğŸ¬ **CLI ì¸í„°í˜ì´ìŠ¤**

### **ğŸ“Š 1ë‹¨ê³„: `generate_scored_windows.py`**

```bash
# ìœˆë„ìš° ì¬ë¯¸ë„ ì ìˆ˜ ê³„ì‚° (20ë¶„ ì†Œìš”, í•œ ë²ˆë§Œ)
python pipeline/generate_scored_windows.py video.mp4 [--force]
```

**ì—­í• **: í´ëŸ¬ìŠ¤í„°ë§ â†’ ìœˆë„ìš° ìƒì„± â†’ XGB í‰ê°€ â†’ scored_windows.json ì €ì¥

### **ğŸ¯ 2ë‹¨ê³„: `select_clips.py`**

```bash
# Config ê¸°ë°˜ í´ë¦½ ì„ ë³„ (1ì´ˆ ì†Œìš”, ë¬´í•œ ì‹¤í—˜)
python pipeline/select_clips.py video.mp4 [--config path/to/config.yaml]
```

**ì—­í• **: scored_windows.json ë¡œë“œ â†’ Config ì ìš© â†’ NMS â†’ ìµœì¢… í´ë¦½ ì„ ë³„

---

## ğŸš€ **ì‚¬ìš© ì›Œí¬í”Œë¡œìš°**

### **âš¡ ê¸°ë³¸ ì‚¬ìš©ë²•**

```bash
# 1. ì ìˆ˜ ê³„ì‚° (í•œ ë²ˆë§Œ)
python pipeline/generate_scored_windows.py "2hour_stream.mp4"

# 2. Config ì‹¤í—˜ (ë¬´í•œ ë°˜ë³µ)
# config íŒŒì¼ì—ì„œ iou_threshold: 0.3ìœ¼ë¡œ ìˆ˜ì •
python pipeline/select_clips.py "2hour_stream.mp4"

# config íŒŒì¼ì—ì„œ iou_threshold: 0.7ë¡œ ìˆ˜ì •  
python pipeline/select_clips.py "2hour_stream.mp4"

# config íŒŒì¼ì—ì„œ target_clips: 10ìœ¼ë¡œ ìˆ˜ì •
python pipeline/select_clips.py "2hour_stream.mp4"
```

### **ğŸ“Š ì‹¤í—˜ ì˜ˆì‹œ**

```yaml
# ì‹¤í—˜ A: ë‹¤ì–‘í•œ í´ë¦½
nms:
  iou_threshold: 0.3     # ë‚®ìŒ = ë” ë§ì€ í´ë¦½ í—ˆìš©
  target_clips: 10
  min_score: 0.5

# ì‹¤í—˜ B: ì—„ì„ ëœ í´ë¦½
nms:
  iou_threshold: 0.7     # ë†’ìŒ = ì—„ê²©í•œ ì„ ë³„
  target_clips: 3
  min_score: 0.8
```

---

## ğŸ“Š **í•µì‹¬ ë°ì´í„° êµ¬ì¡°**

### **ğŸ”¥ `scored_windows.json` (ê°€ì¥ ì¤‘ìš”)**

```json
{
  "metadata": {
    "total_windows": 5665,
    "score_statistics": {"mean": 0.634, "max": 0.947, ...},
    "generated_at": "2025-06-12T14:30:00"
  },
  "generation_config": {
    "clustering_eps": 9,
    "window_lengths": [18, 19, "...", 40],
    "position_ratio": 0.75
  },
  "windows": [
    {
      "id": 0,
      "start_time": 105.0,
      "end_time": 125.0,
      "duration": 20,
      "cluster_id": 3,
      "fun_score": 0.947
    }
  ]
}
```

### **ğŸ¯ `selected_clips.json`**

```json
{
  "selection_info": {
    "selected_at": "2025-06-12T14:30:00",
    "config_used": {
      "iou_threshold": 0.5,
      "target_clips": 5,
      "min_score": 0.6
    }
  },
  "clips": [
    {
      "rank": 1,
      "start_time": 1234.5,
      "end_time": 1254.5,
      "duration": 20.0,
      "fun_score": 0.947
    }
  ]
}
```

---

## ğŸ“ **ì¶œë ¥ êµ¬ì¡°**

```
outputs/
â”œâ”€â”€ preprocessed_data/               # ê¸°ì¡´ ì „ì²˜ë¦¬ ê²°ê³¼
â”œâ”€â”€ tension_data/                    # ê¸°ì¡´ í…ì…˜ ë¶„ì„  
â”œâ”€â”€ visualization/                   # ê¸°ì¡´ ì‹œê°í™”
â””â”€â”€ clip_analysis/                   # ğŸ†• í´ë¦½ ë¶„ì„ ê²°ê³¼
    â””â”€â”€ [ì˜ìƒëª…]_[ë‚ ì§œ]/
        â”œâ”€â”€ metadata.json            # ì˜ìƒ ê¸°ë³¸ ì •ë³´
        â”œâ”€â”€ clusters.json           # í´ëŸ¬ìŠ¤í„°ë§ ê²°ê³¼
        â”œâ”€â”€ scored_windows.json     # ğŸ”¥ ëª¨ë“  ìœˆë„ìš° ì ìˆ˜
        â”œâ”€â”€ selected_clips.json     # ìµœì‹  ì„ ë³„ ê²°ê³¼
        â””â”€â”€ analysis_log.txt        # ì²˜ë¦¬ ë¡œê·¸
```

---

## â±ï¸ **ì„±ëŠ¥ ë° íš¨ìœ¨ì„±**

### **ğŸ“ˆ ì²˜ë¦¬ ìµœì í™”**

- **í´ëŸ¬ìŠ¤í„° ê¸°ë°˜ ìœˆë„ìš°**: 5,665ê°œ (vs ì „ì²´ 21,896ê°œ, 74% ê°ì†Œ)
- **1ë‹¨ê³„ ì²˜ë¦¬ ì‹œê°„**: 20ë¶„ (vs 73ë¶„)
- **2ë‹¨ê³„ ì²˜ë¦¬ ì‹œê°„**: 1ì´ˆ (Config ê¸°ë°˜ ì„ ë³„)

### **ğŸ”„ ì‹¤í—˜ íš¨ìœ¨ì„±**

- **1íšŒ ê³„ì‚°**: scored_windows.json ìƒì„± (20ë¶„)
- **ë¬´í•œ ì‹¤í—˜**: Config ìˆ˜ì • + ì¦‰ì‹œ ì‹¤í–‰ (ê° 1ì´ˆ)
- **ì €ì¥ ê³µê°„**: ~10MB (5,665ê°œ ìœˆë„ìš° ì ìˆ˜)

---

## ğŸ¯ **í•µì‹¬ ì¥ì **

### **âš¡ ì‹¤í—˜ í¸ì˜ì„±**

```
Config ìˆ˜ì • (5ì´ˆ) â†’ ì‹¤í–‰ (1ì´ˆ) â†’ ê²°ê³¼ í™•ì¸ (5ì´ˆ) â†’ ë°˜ë³µ
```

### **ğŸ”§ ë‹¨ìˆœí•œ ê´€ë¦¬**

- ë³µì¡í•œ ëª…ë ¹í–‰ ì˜µì…˜ ì—†ìŒ
- í•˜ë‚˜ì˜ config íŒŒì¼ë§Œ ìˆ˜ì •
- Gitìœ¼ë¡œ config ë³€ê²½ ì´ë ¥ ê´€ë¦¬
- í”„ë¦¬ì…‹ì´ë‚˜ í…œí”Œë¦¿ ë¶ˆí•„ìš”

### **ğŸ“Š ë¬´í•œ ì‹¤í—˜**

- IoU ì„ê³„ê°’ ì‹¤í—˜ (0.3 vs 0.7)
- í´ë¦½ ê°œìˆ˜ ì‹¤í—˜ (3ê°œ vs 10ê°œ)
- ì ìˆ˜ ê¸°ì¤€ ì‹¤í—˜ (0.6 vs 0.8)
- ê¸¸ì´ í•„í„° ì‹¤í—˜ (15-25ì´ˆ vs 20-40ì´ˆ)

---

**ì´ ì‹œìŠ¤í…œì€ í•œ ë²ˆì˜ ì ìˆ˜ ê³„ì‚°ìœ¼ë¡œ ë¬´ê¶ë¬´ì§„í•œ í´ë¦½ ì„ ë³„ ì‹¤í—˜ì´ ê°€ëŠ¥í•œ íš¨ìœ¨ì ì´ê³  ìœ ì—°í•œ êµ¬ì¡°ì…ë‹ˆë‹¤.** ğŸš€

ê¸°ì¡´ ì½”ë“œ ìµœëŒ€ ì¬í™œìš© + ëª¨ë“ˆí™”ëœ ì„¤ê³„ + Config ê¸°ë°˜ ì‹¤í—˜ìœ¼ë¡œ ì—°êµ¬ì™€ ì‹¤ìš©ì„±ì„ ëª¨ë‘ í™•ë³´í–ˆìŠµë‹ˆë‹¤.